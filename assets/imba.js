!function(){"use strict";const t=Symbol.for("#parent"),e=Symbol.for("#state"),i=Symbol.for("#window"),n=Symbol.for("#document"),s=Symbol.for("#imba");class r{constructor(i,n={}){this[t]=i,this[e]=n}get state(){return this[e]}get version(){return"2.0.0-alpha.99"}get window(){return this[i]||globalThis.window}get document(){return this[n]||globalThis.document}get dom(){return this.window}get clearInterval(){return globalThis.clearInterval}get clearTimeout(){return globalThis.clearTimeout}setTimeout(t,e){var i=this;return setTimeout((function(){t(),i.commit()}),e)}setInterval(t,e){var i=this;return setInterval((function(){t(),i.commit()}),e)}run(t){return t()}}globalThis.ImbaContext=r,globalThis.imba=globalThis[s]=new r,imba.mount=function(t,e){let i=e||imba.document.body,n=t;if(t instanceof Function){let e={_:i},s=function(){return imba.ctx=e,t(e)};n=s(),imba.scheduler.listen("render",s)}else n.__F|=64;return i.appendChild(n)},imba.unmount=function(t){throw"Not implemented"},imba.getElementById=function(t){return imba.document.getElementById(t)},imba.q$=function(t,e){return(e instanceof imba.window.Element?e:imba.document).querySelector(t)},imba.q$$=function(t,e){return(e instanceof imba.window.Element?e:imba.document).querySelectorAll(t)};const o=Symbol.for("#__listeners__"),h=/-./g;imba.toCamelCase=function(t){return t.indexOf("-")>=0?t.replace(h,(function(t){return t.charAt(1).toUpperCase()})):t};const a=function(t,e,i){let n,s,r;for(;(n=i)&&(i=i.next);)(s=i.listener)&&(r=i.path&&s[i.path]?e?s[i.path].apply(s,e):s[i.path]():e?s.apply(i,e):s.call(i)),i.times&&--i.times<=0&&(n.next=i.next,i.listener=null)};imba.listen=function(t,e,i,n){let s,r,h;return s=t[o]||(t[o]={}),r=s[e]||(s[e]={}),h=r.tail||(r.tail=r.next={}),h.listener=i,h.path=n,r.tail=h.next={},h},imba.once=function(t,e,i){let n=imba.listen(t,e,i);return n.times=1,n},imba.unlisten=function(t,e,i,n){let s,r,h=t[o];if(h&&(s=h[e]))for(;(r=s)&&(s=s.next);)if(s==i||s.listener==i){r.next=s.next,s.listener=null;break}},imba.emit=function(t,e,i){let n;(n=t[o])&&(n[e]&&a(0,i,n[e]),n.all&&a(0,[e,i],n.all))};const l=Symbol.for("#scheduler");var u="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:function(t){return setTimeout(t,1e3/60)};class c{constructor(){var t=this;this.queue=[],this.stage=-1,this.batch=0,this.scheduled=!1,this.listeners={},this.commit=function(){return t.add("render"),t},this.$promise=null,this.$resolve=null,this.$ticker=function(e){return t.scheduled=!1,t.tick(e)}}add(t,e){return(e||-1==this.queue.indexOf(t))&&this.queue.push(t),this.scheduled||this.schedule(),this}listen(t,e){var i;return(i=this.listeners)[t]||(i[t]=new Set),this.listeners[t].add(e)}unlisten(t,e){return this.listeners[t]&&this.listeners[t].delete(e)}get promise(){var t=this;return this.$promise||(this.$promise=new Promise((function(e){return t.$resolve=e})))}tick(t){var e=this,i=this.queue;if(this.ts||(this.ts=t),this.dt=t-this.ts,this.ts=t,this.queue=[],this.stage=1,this.batch++,i.length)for(let t=0,n=function(t){let e;return t?(e=t.toIterable)?e.call(t):t:[]}(i),s=n.length;t<s;t++){let i=n[t];"string"==typeof i&&this.listeners[i]?this.listeners[i].forEach((function(t){return t.tick instanceof Function?t.tick(e):t instanceof Function?t(e):void 0})):i instanceof Function?i(this.dt,this):i.tick&&i.tick(this.dt,this)}return this.stage=2,this.stage=this.scheduled?0:-1,this.$promise&&(this.$resolve(this),this.$promise=this.$resolve=null),this}schedule(){return this.scheduled||(this.scheduled=!0,-1==this.stage&&(this.stage=0),u(this.$ticker)),this}}globalThis.ImbaScheduler=c,function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(ImbaContext,{get scheduler(){return this[l]||(this[l]=new c)},commit(){return this.scheduler.add("render").promise}});const d=Symbol.for("#parent"),m=Symbol.for("##parent"),f=imba.window.Node;!function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(f,{get[d](){return this[m]||this.parentNode},init$(){return this},replaceWith$(t){return t instanceof f||!t.replace$?this.parentNode.replaceChild(t,this):t.replace$(this),t},insertInto$(t){return t.appendChild$(this),this},insertBefore$(t,e){return this.insertBefore(t,e)},insertBeforeBegin$(t){return this.parentNode.insertBefore(t,this)},insertAfterEnd$(t){return this.nextSibling?this.nextSibling.insertBeforeBegin$(t):this.parentNode.appendChild(t)},insertAfterBegin$(t){return this.childNodes[0]?this.childNodes[0].insertBeforeBegin$(t):this.appendChild(t)}}),function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(imba.dom.Comment,{replaceWith$(t){return t&&t.joinBefore$?t.joinBefore$(this):this.parentNode.insertBefore$(t,this),this.parentNode.removeChild(this),t}});const{Node:p,Element:$,Comment:g,Text:b}=imba.window,v=imba.document;!function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}($,{log(...t){return console.log(...t),this},slot$(t,e){return this},text$(t){return this.textContent=t,this},insert$(t,e,i){let n=typeof t;if("undefined"===n||null===t){if(i&&i instanceof g)return i;let t=v.createComment("");return i?i.replaceWith$(t):t.insertInto$(this),t}if(t===i)return t;if("object"!==n){let n,s=t;return 128&e&&256&e?void(this.textContent=s):i?i instanceof b?(i.textContent=s,i):(n=v.createTextNode(s),i.replaceWith$(n,this),n):(this.appendChild$(n=v.createTextNode(s)),n)}return i?i.replaceWith$(t,this):t.insertInto$(this),t},open$(){return this},close$(){return this},end$(){this.render&&this.render()}}),$.prototype.appendChild$=$.prototype.appendChild,$.prototype.removeChild$=$.prototype.removeChild,$.prototype.insertBefore$=$.prototype.insertBefore,$.prototype.replaceChild$=$.prototype.replaceChild,$.prototype.set$=$.prototype.setAttribute,$.prototype.setns$=$.prototype.setAttributeNS,imba.createElement=function(t,e,i,n){var s=v.createElement(t);return i&&(s.className=i),null!==n&&s.text$(n),e&&e instanceof p&&s.insertInto$(e),s};const y=Symbol.for("#parent"),{Element:x,ShadowRoot:w}=imba.dom;function _(t,e){var i=Object.getOwnPropertyDescriptors(e);return Object.defineProperties(t.prototype,i),t}w.prototype.insert$=x.prototype.insert$,w.prototype.appendChild$=x.prototype.appendChild$,function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(w,{get[y](){return this.host}});const{Node:E,SVGElement:C}=imba.dom,O={};function S(t){let e;return t?(e=t.toIterable)?e.call(t):t:[]}_(C,{set$(t,e){var i;let n=function t(e,i,n){if(!e)return n[i]=null;if(void 0!==n[i])return n[i];let s=Object.getOwnPropertyDescriptor(e,i);return void 0!==s||e==C?n[i]=s||null:t(Reflect.getPrototypeOf(e),i,n)}(this,t,O[i=this.nodeName]||(O[i]={}));n&&n.set?this[t]=e:this.setAttribute(t,e)}}),_(C,{flag$(t){let e=this.flags$ns;this.className.baseVal=e?e+(this.flags$ext=t):this.flags$ext=t},flagSelf$(t){var e=this;return this.flag$=function(t){return e.flagSync$(e.flags$ext=t)},this.flagSelf$=function(t){return e.flagSync$(e.flags$own=t)},this.flagSelf$(t)},flagSync$(){return this.className.baseVal=(this.flags$ns||"")+(this.flags$ext||"")+" "+(this.flags$own||"")+" "+(this.$flags||"")}}),imba.createSVGElement=function(t,e,i,n,s){var r=imba.document.createElementNS("http://www.w3.org/2000/svg",t);return i&&(r.className.baseVal=i),e&&e instanceof E&&r.insertInto$(e),r};const F=Symbol.for("#parent"),N=Symbol.for("##up"),k=Symbol.for("##parent"),{Element:I,Text:P}=imba.dom;!function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(imba.dom.DocumentFragment,{get[F](){return this[N]||this[k]},setup$(t,e){return this.$start=imba.document.createComment("start"),this.$end=imba.document.createComment("end"),this.$end.replaceWith$=function(t){return this.parentNode.insertBefore(t,this),t},this.appendChild(this.$start),this.appendChild(this.$end)},text$(t){this.$text?this.$text.textContent=t:this.$text=this.insert$(t)},insert$(t,e,i){return this[k]?this[k].insert$(t,e,i||this.$end):I.prototype.insert$.call(this,t,e,i||this.$end)},insertInto$(t,e){return this[k]||(this[k]=t,t.appendChild$(this)),this},replaceWith$(t,e){this.$start.insertBeforeBegin$(t);for(var i=this.$start;i;){let t=i.nextSibling;if(this.appendChild(i),i==this.$end)break;i=t}return t},appendChild$(t){return this.$end?this.$end.insertBeforeBegin$(t):this.appendChild(t),t},removeChild$(t){return t.parentNode&&t.parentNode.removeChild(t),this},isEmpty$(){let t=this.$start,e=this.$end;for(;(t=t.nextSibling)&&t!=e;)if(t instanceof I||t instanceof P)return!1;return!0}});class T{constructor(t,e){this.__F=t,this[F]=e,!(128&t)&&this instanceof j&&(this.$start=imba.document.createComment("start"),e&&e.appendChild$(this.$start)),256&t||(this.$end=imba.document.createComment("end"),e&&e.appendChild$(this.$end)),this.setup()}appendChild$(t,e){this.$end&&this[F]?this.$end.insertBeforeBegin$(t):this[F]&&this[F].appendChild$(t)}replaceWith$(t){this.detachNodes(),this.$end.insertBeforeBegin$(t),this[F].removeChild$(this.$end),this[F]=null}joinBefore$(t){return this.insertInto$(t.parentNode,t)}insertInto$(t,e){return this[F]||(this[F]=t,e?e.insertBeforeBegin$(this.$end):t.appendChild$(this.$end),this.attachNodes()),this}replace$(t){return this[F]||(this[F]=t.parentNode),t.replaceWith$(this.$end),this.attachNodes(),this}setup(){return this}}class j extends T{setup(){return this.array=[],this.changes=new Map,this.dirty=!1,this.$={}}push(t,e){if(!(1&this.__F))return this.array.push(t),void this.appendChild$(t);let i=this.array[e];if(i===t);else{this.dirty=!0;let n=this.array.indexOf(t),s=this.changes.get(t);-1===n?(this.array.splice(e,0,t),this.insertChild(t,e)):n===e+1?(i&&this.changes.set(i,-1),this.array.splice(e,1)):(n>=0&&this.array.splice(n,1),this.array.splice(e,0,t),this.insertChild(t,e)),-1==s&&this.changes.delete(t)}}insertChild(t,e){if(e>0){this.array[e-1].insertAfterEnd$(t)}else this.$start?this.$start.insertAfterEnd$(t):this[F].insertAfterBegin$(t)}removeChild(t,e){t.parentNode==this[F]&&this[F].removeChild(t)}attachNodes(){for(let t=0,e=S(this.array),i=e.length;t<i;t++){let i=e[t];this.$end.insertBeforeBegin$(i)}}detachNodes(){for(let t=0,e=S(this.array),i=e.length;t<i;t++){let i=e[t];this[F].removeChild(i)}}end$(t){var e=this;if(1&this.__F){if(this.dirty&&(this.changes.forEach((function(t,i){if(-1==t)return e.removeChild(i)})),this.changes.clear(),this.dirty=!1),this.array.length>t)for(;this.array.length>t;){let t=this.array.pop();this.removeChild(t)}}else this.__F|=1}}class B extends T{setup(){return this.$=[],this.length=0}end$(t){let e=this.length;if(e==t||!this[F])return;let i=this.$,n=this[F];if(e>t)for(;e>t;)n.removeChild$(i[--e]);else if(t>e)for(;t>e;)this.appendChild$(i[e++]);this.length=t}attachNodes(){for(let t=0,e=S(this.$),i=e.length;t<i;t++){let i=e[t];if(t==this.length)break;this.$end.insertBeforeBegin$(i)}}detachNodes(){let t=0;for(;t<this.length;){let e=this.$[t++];this[F].removeChild$(e)}}}imba.createLiveFragment=function(t,e,i){var n=imba.document.createDocumentFragment();return n.setup$(t,e),i&&(n[N]=i),n},imba.createIndexedFragment=function(t,e){return new B(t,e)},imba.createKeyedFragment=function(t,e){return new j(t,e)};const V=Symbol.for("#context"),A=Symbol.for("#parent"),R=Symbol.for("##context"),L={get(t,e){let i=t,n=void 0;for(;i&&null==n;)(i=i[A])&&(n=i[e]);return n}};!function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(imba.dom.Node,{get $context(){return console.warn("$context is deprecated - use #context instead")},get[V](){return this[R]||(this[R]=new Proxy(this,L))}});const M=Symbol.for("##parent"),D=imba.dom,q=imba.document;imba.window.ImbaElement=class extends imba.window.HTMLElement{constructor(){super(),this.flags$ns&&(this.flag$=this.flagExt$),this.setup$(),this.build()}setup$(){return this.__slots={},this.__F=0}init$(){return this.__F|=3,this}flag$(t){this.className=this.flags$ext=t}slot$(t,e){var i;return"__"!=t||this.render?(i=this.__slots)[t]||(i[t]=imba.createLiveFragment(0,null,this)):this}build(){return this}awaken(){return this}mount(){return this}unmount(){return this}rendered(){return this}dehydrate(){return this}hydrate(){return this.autoschedule=!0,this}tick(){return this.commit()}visit(){return this.commit()}commit(){return this.isRender?(this.__F|=256,this.render&&this.render(),this.rendered(),this.__F=-257&(512|this.__F)):this}get autoschedule(){return 0!=(64&this.__F)}set autoschedule(t){t?this.__F|=64:this.__F&=-65}get isRender(){return!0}get isMounting(){return 0!=(16&this.__F)}get isMounted(){return 0!=(32&this.__F)}get isAwakened(){return 0!=(8&this.__F)}get isRendered(){return 0!=(512&this.__F)}get isRendering(){return 0!=(256&this.__F)}get isScheduled(){return 0!=(128&this.__F)}get isHydrated(){return 0!=(2&this.__F)}schedule(){return imba.scheduler.listen("render",this),this.__F|=128,this}unschedule(){return imba.scheduler.unlisten("render",this),this.__F&=-129,this}end$(){return this.visit()}connectedCallback(){let t=this.__F,e=1&t,i=8&t;if(48&t)return;this.__F|=16,e||this.init$(),2&t||(this.flags$ext=this.className,this.hydrate(),this.__F|=2,this.commit()),i||(this.awaken(),this.__F|=8);let n=this.mount();return n&&n.then instanceof Function&&n.then(imba.scheduler.commit),t=this.__F=-17&(32|this.__F),64&t&&this.schedule(),this}disconnectedCallback(){return this.__F=-49&this.__F,128&this.__F&&this.unschedule(),this.unmount()}};const H={};imba.tags=new class{constructor(){this.types={}}lookup(t){return this.types[t]}get(t,e){return t&&"component"!=t?this.types[t]?this.types[t]:e&&D[e]?D[e]:D.customElements.get(t)||D.ImbaElement:D.ImbaElement}create(t){return this.types[t]?this.types[t].create$():q.createElement(t)}define(t,e,i={}){this.types[t]=e,e.nodeName=t;let n=e.prototype,s=n._ns_;if(i.ns){let t=i.ns,e=t+" "+t+"_ ";s&&(e+=n.flags$ns,t+=" "+s),n._ns_=t,n.flags$ns=e}return i.extends?H[t]=e:D.customElements.define(t,e),e}};const W=imba.window.ImbaElement.prototype;imba.createComponent=function(t,e,i,n,s){var r;return"string"!=typeof t&&t&&t.nodeName&&(t=t.nodeName),H[t]?((r=H[t].create$(r)).slot$=W.slot$,r.__slots={}):r=q.createElement(t),r[M]=e,r.init$(),null!==n&&r.slot$("__").text$(n),(i||r.flags$ns)&&r.flag$(i||""),r};const{Element:z}=imba.dom;class X{constructor(t){this.dom=t,this.string=""}contains(t){return this.dom.classList.contains(t)}add(t){return this.contains(t)||(this.string+=(this.string?" ":"")+t,this.dom.classList.add(t)),this}remove(t){if(!this.contains(t))return this;var e=new RegExp("(^|\\s)*"+t+"(\\s|$)*","g");return this.string=this.string.replace(e,""),this.dom.classList.remove(t),this}toggle(t,e){return void 0===e&&(e=!this.contains(t)),e?this.add(t):this.remove(t)}incr(t){let e=this.stacks||(this.stacks={}),i=e[t]||0;return i<1&&this.add(t),e[t]=Math.max(i,0)+1,this}decr(t){let e=this.stacks||(this.stacks={}),i=e[t]||0;return 1==i&&this.remove(t),e[t]=Math.max(i,1)-1,this}valueOf(){return this.string}toString(){return this.string}sync(){return this.dom.flagSync$()}}!function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(z,{get flags(){return this.$flags||(this.$flags=new X(this),this.flag$==z.prototype.flag$&&(this.flags$ext=this.className),this.flagDeopt$()),this.$flags},flag$(t){let e=this.flags$ns;this.className=e?e+(this.flags$ext=t):this.flags$ext=t},flagDeopt$(){var t=this;this.flag$=this.flagExt$,this.flagSelf$=function(e){return t.flagSync$(t.flags$own=e)}},flagExt$(t){return this.flagSync$(this.flags$ext=t)},flagSelf$(t){return this.flagDeopt$(),this.flagSelf$(t)},flagSync$(){return this.className=(this.flags$ns||"")+(this.flags$ext||"")+" "+(this.flags$own||"")+" "+(this.$flags||"")}});const Y={cm:1,mm:1,Q:1,pc:1,pt:1,px:1,em:1,ex:1,ch:1,rem:1,vw:1,vh:1,vmin:1,vmax:1,s:1,ms:1,fr:1,"%":1,in:1,turn:1,grad:1,rad:1,deg:1,Hz:1,kHz:1},K={prefix:1,suffix:1,content:1},U=/^([xyz])$/,G=/^([tlbr]|size|[whtlbr]|[mps][tlbrxy]?|[rcxy]?[gs])$/,Q=imba.css||(imba.css={});let J,Z="*,::before,::after {\nbox-sizing: border-box;\nborder-width: 0;\nborder-style: solid;\nborder-color: currentColor;\n}";const tt={};function et(t){let e;return t?(e=t.toIterable)?e.call(t):t:[]}function it(t,e){var i=Object.getOwnPropertyDescriptors(e);return Object.defineProperties(t.prototype,i),t}Q.setup=function(){if(!J&&(J=imba.document.documentElement))return this.register(Z,"root")},Q.register=function(t,e){if(tt.root||"root"==e||Q.register(Z,"root"),e&&!tt[e]){let i=tt[e]={raw:t};i.node=imba.document.createElement("style"),i.node.textContent=i.raw,imba.document.head.appendChild(i.node)}},Q.toValue=function(t,e,i){K[i]&&(t=String(t));let n=typeof t;if("number"==n){if(e||(U.test(i)?e="px":G.test(i)?e="u":"rotate"==i&&(e="turn")),e)return Y[e]?t+e:"u"==e?4*t+"px":"calc(var(--u_"+e+",1px) * "+t+")"}else"string"==n&&i&&K[i]&&'"'!=t[0]&&"'"!=t[0]&&(t.indexOf('"')>=0?-1==t.indexOf("'")&&(t="'"+t+"'"):t='"'+t+'"');return t},Q.toStyleSheet=function(){return Object.values(tt).map((function(t){return t.raw})).join("\n\n")},Q.parseDimension=function(t){if("string"==typeof t){let[e,i,n]=t.match(/^([-+]?[\d\.]+)(%|\w+)$/);return[parseFloat(i),n]}if("number"==typeof t)return[t]},imba.inlineStyles=Q.register,imba.toStyleValue=Q.toValue,imba.getAllStyles=Q.toStyleSheet,function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(imba.dom.Element,{css$(t,e,i){return this.style[t]=e},css$var(t,e,i,n){let s=Q.toValue(e,i,n);this.style.setProperty(t,s)}});const nt={INPUT:!0,SELECT:!0,TEXTAREA:!0,BUTTON:!0};var st=function(t){return t instanceof Array||t&&t.has instanceof Function},rt=function(t,e){return t==e||(t instanceof Array?t.indexOf(e)>=0:t&&t.has instanceof Function?t.has(e):!!(t&&t.contains instanceof Function)&&t.contains(e))},ot=function(t,e){return t instanceof Array?t.push(e):t&&t.add instanceof Function?t.add(e):void 0},ht=function(t,e){if(t instanceof Array){let i=t.indexOf(e);if(i>=0)return t.splice(i,1)}else if(t&&t.delete instanceof Function)return t.delete(e)};function at(t){let e;return t?(e=t.toIterable)?e.call(t):t:[]}it(imba.dom.Element,{getRichValue(){return this.value},setRichValue(t){return this.value=t},bind$(t,e){let i=e||[];var n;return"data"==t&&!this.$$bound&&nt[this.nodeName]&&(this.$$bound=!0,this.change$&&this.addEventListener("change",this.change$=this.change$.bind(this)),this.input$&&this.addEventListener("input",this.input$=this.input$.bind(this),{capture:!0}),this.click$&&this.addEventListener("click",this.click$=this.click$.bind(this),{capture:!0})),Object.defineProperty(this,t,i instanceof Array?(n=i,{get:function(){return n[0]?n[0][n[1]]:void 0},set:function(t){return n[0]?n[0][n[1]]=t:null}}):i),i}}),Object.defineProperty(imba.dom.Element.prototype,"richValue",{get:function(){return this.getRichValue()},set:function(t){return this.setRichValue(t)}}),it(imba.dom.HTMLSelectElement,{change$(t){let e=this.data,i=this.$$value;this.$$value=void 0;let n=this.getRichValue();if(this.multiple){if(i)for(let t=0,s=et(i),r=s.length;t<r;t++){let i=s[t];-1==n.indexOf(i)&&ht(e,i)}for(let t=0,s=et(n),r=s.length;t<r;t++){let n=s[t];i&&-1!=i.indexOf(n)||ot(e,n)}}else this.data=n[0];return imba.commit(),this},getRichValue(){var t;if(this.$$value)return this.$$value;t=[];for(let e=0,i=et(this.selectedOptions),n=i.length;e<n;e++){let n=i[e];t.push(n.richValue)}return this.$$value=t},syncValue(){let t=this.data;if(this.multiple){let e=[];for(let i=0,n=et(this.options),s=n.length;i<s;i++){let s=n[i],r=s.richValue,o=rt(t,r);s.selected=o,o&&e.push(r)}this.$$value=e}else for(let e=0,i=et(this.options),n=i.length;e<n;e++){let n=i[e].richValue;if(n==t){this.$$value=[n],this.selectedIndex=e;break}}},end$(){return this.syncValue()}}),it(imba.dom.HTMLOptionElement,{setRichValue(t){return this.$$value=t,this.value=t},getRichValue(){return void 0!==this.$$value?this.$$value:this.value}}),it(imba.dom.HTMLTextAreaElement,{setRichValue(t){return this.$$value=t,this.value=t},getRichValue(){return void 0!==this.$$value?this.$$value:this.value},input$(t){return this.data=this.value,imba.commit()},end$(){if(this.$$bound&&this.value!=this.data)return this.value=this.data}}),it(imba.dom.HTMLInputElement,{input$(t){let e=this.type;if("checkbox"!=e&&"radio"!=e)return this.$$value=void 0,this.data=this.richValue,imba.commit()},change$(t){let e=this.data,i=this.richValue;if("checkbox"==this.type||"radio"==this.type){let t=this.checked;st(e)?t?ot(e,i):ht(e,i):this.data=!!t&&i}return imba.commit()},setRichValue(t){this.$$value!==t&&(this.$$value=t,this.value!==t&&(this.value=t))},getRichValue(){if(void 0!==this.$$value)return this.$$value;let t=this.value,e=this.type;return"range"==e||"number"==e?(t=this.valueAsNumber,Number.isNaN(t)&&(t=null)):"checkbox"==e&&(null!=t&&"on"!==t||(t=!0)),t},end$(){if(this.$$bound){let t=this.type;if("checkbox"==t||"radio"==t){let t=this.data;this.checked=!0===t||!1===t||null==t?!!t:rt(t,this.richValue)}else this.richValue=this.data}}}),it(imba.dom.HTMLButtonElement,{get checked(){return this.$checked},set checked(t){t!=this.$checked&&(this.$checked=t,this.flags.toggle("checked",!!t))},setRichValue(t){return this.$$value=t,this.value=t},getRichValue(){return void 0!==this.$$value?this.$$value:this.value},click$(t){let e=this.data,i=this.checked,n=this.richValue;return st(e)?i?ht(e,n):ot(e,n):this.data=i?null:n,this.end$(),imba.commit()},end$(){if(this.$$bound){let t=this.data;this.checked=!0===t||!1===t||null==t?!!t:rt(t,this.richValue)}}});const{Event:lt,Element:ut}=imba.dom,ct={esc:[27],tab:[9],enter:[13],space:[32],up:[38],down:[40],left:[37],right:[39],del:[8,46]};lt.log$mod=function(...t){return console.log(...t),!0},lt.sel$mod=function(t){return!!this.event.target.matches(String(t))},lt.if$mod=function(t){return!!t},lt.wait$mod=function(t=250){return new Promise((function(e){return setTimeout(e,t)}))},lt.self$mod=function(){return this.event.target==this.element},lt.throttle$mod=function(t=250){var e=this;return!this.handler.throttled&&(this.handler.throttled=!0,this.element.flags.incr("throttled"),imba.once(this.current,"end",(function(){return setTimeout((function(){return e.element.flags.decr("throttled"),e.handler.throttled=!1}),t)})),!0)},lt.flag$mod=function(t,e){let i=e instanceof imba.dom.Element?e:e?this.element.closest(e):this.element;if(!i)return!0;let n=this.step;this.state[n]=this.id,i.flags.incr(t);let s=Date.now();return imba.once(this.current,"end",(function(){let e=Date.now()-s,n=Math.max(250-e,0);return setTimeout((function(){return i.flags.decr(t)}),n)})),!0},lt.busy$mod=function(t){return lt.flag$mod.call(this,"busy",250,t)},lt.mod$mod=function(t){return lt.flag$mod.call(this,"mod-"+t,imba.document.documentElement)};class dt{constructor(t,e){this.params=t,this.closure=e}getHandlerForMethod(t,e){return t?t[e]?t:this.getHandlerForMethod(t.parentNode,e):null}emit(t,...e){return imba.emit(this,t,e)}on(t,...e){return imba.listen(this,t,...e)}once(t,...e){return imba.once(this,t,...e)}un(t,...e){return imba.unlisten(this,t,...e)}async handleEvent(t){t.target;var e=t.currentTarget,i=this.params;let n=!0;this.count||(this.count=0),this.state||(this.state={});let s={element:e,event:t,modifiers:i,handler:this,id:++this.count,step:-1,state:this.state,current:null};if(s.current=s,t.handle$mod&&0==t.handle$mod.apply(s,i.options||[]))return;let r=lt[this.type+"$handle"]||lt[t.type+"$handle"]||t.handle$mod;if(!r||0!=r.apply(s,i.options||[])){this.currentEvents||(this.currentEvents=new Set),this.currentEvents.add(t);for(let r,o,h=0,a=Object.keys(i),l=a.length;h<l;h++){if(r=a[h],o=i[r],s.step++,"_"==r[0])continue;r.indexOf("~")>0&&(r=r.split("~")[0]);let l,u=null,c=[t,s],d=void 0,m=null;if("$"==r[0]&&"_"==r[1]&&o[0]instanceof Function)r=o[0],c=[t,s].concat(o.slice(1)),m=e;else if(o instanceof Array){c=o.slice(),u=c;for(let e=0,i=at(c),n=i.length;e<n;e++){let n=i[e];if("string"==typeof n&&"~"==n[0]&&"$"==n[1]){let i=n.slice(2).split("."),r=s[i.shift()]||t;for(let t=0,e=at(i),n=e.length;t<n;t++){let i=e[t];r=r?r[i]:void 0}c[e]=r}}}if("string"==typeof r&&(l=r.match(/^(emit|flag|mod|moved|pin|fit|refit|map|remap)-(.+)$/))&&(u||(u=c=[]),c.unshift(l[2]),r=l[1]),"stop"==r)t.stopImmediatePropagation();else if("prevent"==r)t.preventDefault();else if("commit"==r)n=!0;else if("silence"==r||"silent"==r)n=!1;else if("ctrl"==r){if(!t.ctrlKey)break}else if("alt"==r){if(!t.altKey)break}else if("shift"==r){if(!t.shiftKey)break}else if("meta"==r){if(!t.metaKey)break}else if("once"==r)e.removeEventListener(t.type,this);else{if("options"==r)continue;if(ct[r]){if(ct[r].indexOf(t.keyCode)<0)break}else if("emit"==r){let i=c[0],n=c[1],s=new CustomEvent(i,{bubbles:!0,detail:n});s.originalEvent=t;e.dispatchEvent(s)}else if("string"==typeof r){let i=this.type&&lt[this.type+"$"+r+"$mod"];i||(i=t[r+"$mod"]||lt[t.type+"$"+r]||lt[r+"$mod"]),i instanceof Function?(r=i,m=s,c=u||[]):"_"==r[0]?(r=r.slice(1),m=this.closure):m=this.getHandlerForMethod(e,r)}}if(r instanceof Function?d=r.apply(m||e,c):m&&(d=m[r].apply(m,c)),d&&d.then instanceof Function&&d!=imba.scheduler.$promise&&(n&&imba.scheduler.commit(),d=await d),!1===d)break;s.value=d}imba.emit(s,"end",s),n&&imba.scheduler.commit(),this.currentEvents.delete(t),0==this.currentEvents.size&&this.emit("idle")}}}!function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(ut,{emit(t,e,i={bubbles:!0}){null!=e&&(i.detail=e);let n=new CustomEvent(t,i);this.dispatchEvent(n);return n},on$(t,e,i){let n,s="on$"+t;this[s]instanceof Function&&(n=this[s](e,i)),n=new dt(e,i);let r=e.capture,o=e.passive,h=r;return o&&(h={passive:o,capture:r}),/^(pointerdrag|touch)$/.test(t)&&(n.type=t,t="pointerdown"),this.addEventListener(t,n,h),n}});const mt={},ft=imba.assets||(imba.assets={}),pt=imba.window.Node;ft.register=function(t,e){return mt[t]=e,this},ft.create=function(t,e,i){let n=mt[t];if(!n.node){let t=imba.document.createElementNS("http://www.w3.org/2000/svg","svg");for(let e,i,s=n.attributes,r=0,o=Object.keys(s),h=o.length;r<h;r++)e=o[r],i=s[e],t.setAttribute(e,i);t.innerHTML=n.content,t.className.baseVal=n.flags.join(" "),n.node=t}let s=n.node.cloneNode(!0),r=s.flags$ns=s.className.baseVal+" ";return s.className.baseVal=r+i,e&&e instanceof pt&&s.insertInto$(e),s},ImbaContext.prototype.registerAsset=ft.register,ImbaContext.prototype.createAssetElement=ft.create;const{Event:$t,PointerEvent:gt,Element:bt}=imba.dom;function vt(t,e=1){let i=1/e;return Math.round(t*i)/i}function yt(t){if("string"==typeof t){let[e,i,n]=t.match(/^([-+]?[\d\.]+)(%|\w+)$/);return[parseFloat(i),n]}if("number"==typeof t)return[t]}function xt(t,e,i,n,s=.1){let[r,o]=yt(i),[h,a]=yt(n),[l,u]=yt(s);return"%"==o&&(r=r/100*(e-t)),"%"==a&&(h=h/100*(e-t)),"%"==u&&(l=l/100*(h-r)),function(i,n){let o=r+(h-r)*((i-t)/(e-t));return s&&(o=vt(o,l)),n&&(o=function(t,e,i){return e>i?Math.max(i,Math.min(e,t)):Math.min(i,Math.max(e,t))}(o,r,h)),o}}!function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(gt,{primary$mod(){return!!this.event.isPrimary},mouse$mod(){return"mouse"==this.event.pointerType},pen$mod(){return"pen"==this.event.pointerType},touch$mod(){return"touch"==this.event.pointerType},pressure$mod(t=0){return this.event.pressure>t},lock$mod:t=>!0});class wt{constructor(t,e,i){this.phase="init",this.events=[],this.event=t,this.handler=e,this.target=this.currentTarget=i}set event(t){this.x=t.clientX,this.y=t.clientY,this.events.push(t)}get start(){return this.events[0]}get event(){return this.events[this.events.length-1]}get elapsed(){return this.event.timeStamp-this.events[0].timeStamp}get pointerId(){return this.event.pointerId}get clientX(){return this.event.clientX}get clientY(){return this.event.clientY}get offsetX(){return this.event.offsetX}get offsetY(){return this.event.offsetY}get type(){return this.event.type}emit(t,...e){return imba.emit(this,t,e)}on(t,...e){return imba.listen(this,t,...e)}once(t,...e){return imba.once(this,t,...e)}un(t,...e){return imba.unlisten(this,t,...e)}}function _t(t){let e;return t?(e=t.toIterable)?e.call(t):t:[]}$t.touch$in$mod=function(){return $t.touch$reframe$mod.apply(this,arguments)},$t.touch$fit$mod=function(){var t,e;(t=this.state)[e=this.step]||(t[e]={clamp:!0});return $t.touch$reframe$mod.apply(this,arguments)},$t.touch$snap$mod=function(t=1,e=t){return this.event.x=vt(this.event.x,t),this.event.y=vt(this.event.y,e),!0},$t.touch$moved$mod=function(t,e){var i,n,s=this;let r=(i=this.state)[n=this.step]||(i[n]={});if(!r.setup){let i=t||4;"string"==typeof t&&t.match(/^(up|down|left|right|x|y)$/)&&(r.dir=t,i=e||4),r.setup=!0;let[n,s]=yt(i);r.threshold=n,r.sy=n,r.x0=this.event.x,r.y0=this.event.y,s&&"px"!=s&&console.warn("only px threshold allowed in @touch.moved")}if(r.active)return!0;let o=r.threshold,h=this.event.x-r.x0,a=this.event.y-r.y0,l=!1;if(h>o&&("right"==r.dir||"x"==r.dir)&&(l=!0),!l&&h<-o&&("left"==r.dir||"x"==r.dir)&&(l=!0),!l&&a>o&&("down"==r.dir||"y"==r.dir)&&(l=!0),!l&&a<-o&&("up"==r.dir||"y"==r.dir)&&(l=!0),!l){Math.sqrt(h*h+a*a)>o&&!r.dir&&(l=!0)}if(l){r.active=!0;let t=this.state.pinTarget;this.element.flags.incr("_move_"),t&&t.flags.incr("_move_"),imba.once(this.current,"end",(function(){return t&&t.flags.decr("_move_"),s.element.flags.decr("_move_")}))}return!!r.active},$t.touch$reframe$mod=function(...t){var e,i;let n=(e=this.state)[i=this.step]||(e[i]={});if(n.rect){let t=this.event.x=n.x(this.event.x,n.clamp),e=this.event.y=n.y(this.event.y,n.clamp);this.event.dx=t-this.event.x0,this.event.dy=e-this.event.y0}else{let e=this.element,i=t.length,s=t[0],r=0,o="100%",h=1,a=typeof s;"number"==a||"string"==a&&/^([-+]?\d[\d\.]*)(%|\w+)$/.test(s)||s instanceof Array?s=null:"string"==a&&(s="this"==s||""==s?this.element:"up"==s?this.element.parentNode:"op"==s?this.element.offsetParent:e.closest(s)||e.querySelector(s)),null==s&&(i++,t.unshift(s=e)),2==i?h=t[1]:i>2&&([r,o,h=1]=t.slice(1));let l=s.getBoundingClientRect();r instanceof Array||(r=[r,r]),o instanceof Array||(o=[o,o]),h instanceof Array||(h=[h,h]),n.rect=l,n.x=xt(l.left,l.right,r[0],o[0],h[0]),n.y=xt(l.top,l.bottom,r[1],o[1],h[1]),this.state.scaleX=n.x,this.state.scaleY=n.y,this.event.x0=this.event.x=n.x(this.event.x,n.clamp),this.event.y0=this.event.y=n.y(this.event.y,n.clamp)}return!0},$t.touch$pin$mod=function(...t){let e=this.state[this.step];if(!e){let i=t[0];"string"==typeof i&&(i=this.element.closest(i)||this.element.querySelector(i)),i instanceof bt||t.unshift(i=this.state.target);let n=t[1]||0,s=null==t[2]?t[2]=n:t[2],r=i.getBoundingClientRect();e=this.state[this.step]={x:this.state.clientX-(r.left+r.width*n),y:this.state.clientY-(r.top+r.height*s)},i&&(this.state.pinTarget=i,i.flags.incr("_touch_"),this.state.once("end",(function(){return i.flags.decr("_touch_")})))}return this.event.x-=e.x,this.event.y-=e.y,!0},$t.touch$lock$mod=function(...t){let e=this.state[this.step];if(!e){e=this.state[this.step]=this.state.target.style;e.touchAction;e.touchAction="none",this.state.once("end",(function(){return e.removeProperty("touch-action")}))}return!0},$t.touch$sync$mod=function(t,e="x",i="y"){let n=this.state[this.step];return n||(n=this.state[this.step]={x:t[e]||0,y:t[i]||0,tx:this.state.x,ty:this.state.y}),e&&(t[e]=n.x+(this.state.x-n.tx)),i&&(t[i]=n.y+(this.state.y-n.ty)),!0},$t.touch$handle=function(){var t=this;let e=this.event,i=this.element,n=this.state.pointerId;if(this.current=this.state,null!=n)return n==e.pointerId;let s=this.state=this.handler.state=this.current=new wt(e,this.handler,i),r=function(t){return t.preventDefault(),!1},o=function(e){let n=e.type;s.event=e;try{t.handler.handleEvent(s)}catch(e){}if("pointerup"==n||"pointercancel"==n)return i.releasePointerCapture(e.pointerId)};return i.flags.incr("_touch_"),i.setPointerCapture(e.pointerId),i.addEventListener("pointermove",o),i.addEventListener("pointerup",o),i.addEventListener("pointercancel",o),i.addEventListener("lostpointercapture",(function(e){return i.flags.decr("_touch_"),s.emit("end"),t.handler.state={},i.removeEventListener("pointermove",o),i.removeEventListener("pointerup",o),i.removeEventListener("pointercancel",o),imba.document.removeEventListener("selectstart",r)}),{once:!0}),imba.document.addEventListener("selectstart",r,{capture:!0}),o(e),!1};const Et=new(globalThis.WeakMap||Map),Ct={threshold:[0]},Ot={},{Event:St,CustomEvent:Ft,Element:Nt}=imba.dom;function kt(t=Ct){let e=t.threshold.join("-")+t.rootMargin,i=t.root||Ot,n=Et.get(i);return n||Et.set(i,n={}),n[e]||(n[e]=new IntersectionObserver((s="intersect",function(t,e){let i=e.prevRatios||(e.prevRatios=new WeakMap);for(let n=0,r=_t(t),o=r.length;n<o;n++){let t=r[n],o=i.get(t.target)||0,h=t.intersectionRatio,a={entry:t,ratio:h,from:o,delta:h-o,observer:e},l=new Ft(s,{bubbles:!1,detail:a});l.entry=t,l.isIntersecting=t.isIntersecting,l.delta=a.delta,l.ratio=a.ratio,i.set(t.target,h),t.target.dispatchEvent(l)}}),t));var s}St.intersect$handle=function(){let t=this.event.detail.observer;return this.modifiers._observer==t},St.intersect$in=function(){return this.event.delta>=0&&this.event.entry.isIntersecting},St.intersect$out=function(){return this.event.delta<0},Nt.prototype.on$intersect=function(t,e){let i;if(t.options){let e=[],n={threshold:e};for(let i=0,s=_t(t.options),r=s.length;i<r;i++){let t=s[i];t instanceof Nt?n.root=t:"number"==typeof t&&e.push(t)}if(1==e.length){let t=e[0];if(t>1)for(e[0]=0;e.length<t;)e.push(e.length/(t-1))}0==e.length&&e.push(0),i=kt(n)}else i=kt();return t._observer=i,i.observe(this)};const{Event:It,CustomEvent:Pt,Element:Tt}=imba.dom;var jt=null;!function(t,e){var i=Object.getOwnPropertyDescriptors(e);Object.defineProperties(t.prototype,i)}(Tt,{on$resize(t,e){return(globalThis.ResizeObserver||jt||(console.warn(":resize not supported in this browser"),jt={observe:function(){return!0}}),jt||(jt=new ResizeObserver((function(t){for(let e=0,i=function(t){let e;return t?(e=t.toIterable)?e.call(t):t:[]}(t),n=i.length;e<n;e++){let t=i[e],n=new Pt("resize",{bubbles:!1,detail:t});n.entry=t,n.rect=t.contentRect,n.width=t.target.offsetWidth,n.height=t.target.offsetHeight,t.target.dispatchEvent(n)}})))).observe(this)}});const{Event:Bt,CustomEvent:Vt,Element:At}=imba.dom;var Rt,Lt=Symbol();At.prototype.on$selection=function(t,e){return function(){if(!Rt)return Rt=function(t){if(t[Lt])return;t[Lt]=!0;let e=imba.document.activeElement;if(e&&e.matches("input,textarea")){let t=new Vt("selection",{detail:{start:e.selectionStart,end:e.selectionEnd}});return e.dispatchEvent(t)}},imba.document.addEventListener("selectionchange",Rt)}()}}();